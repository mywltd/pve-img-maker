# 在调整磁盘大小后，需要重新安装 grub
run-command grub-install /dev/sda
# 禁止 grub 检测其他系统，加快启动速度
# append-line /etc/default/grub:GRUB_DISABLE_OS_PROBER=true
# 更新 grub 设置
run-command update-grub

# 修改 apt 镜像源
run-command sed -i 's|//archive.ubuntu.com|//mirrors.cernet.edu.cn|g' /etc/apt/sources.list
run-command sed -i 's|//security.ubuntu.com|//mirrors.cernet.edu.cn|g' /etc/apt/sources.list
run-command sed -i 's|//archive.ubuntu.com|//mirrors.cernet.edu.cn|g' /etc/cloud/cloud.cfg
run-command sed -i 's|//security.ubuntu.com|//mirrors.cernet.edu.cn|g' /etc/cloud/cloud.cfg

# 禁用自动升级
run-command sed -i 's|1|0|g' /etc/apt/apt.conf.d/10periodic
run-command sed -i 's|1|0|g' /etc/apt/apt.conf.d/20auto-upgrades

# 更新 apt 数据
update
# 更新现有包
run-command apt full-upgrade -y
# 安装基础软件包
install sudo,qemu-guest-agent,wget,curl,net-tools,nano,vim,screen,tmux,htop,ncdu,axel

# 禁用 apt 更新提示
run-command systemctl disable motd-news.timer apt-daily.timer apt-daily-upgrade.timer update-notifier-download.timer update-notifier-motd.timer

# 禁止 root 用户通过 ssh 登录
append-line /etc/ssh/sshd_config.d/00-user-init.conf:PermitRootLogin no
# 允许使用密码登录
append-line /etc/ssh/sshd_config.d/00-user-init.conf:PasswordAuthentication yes

# 禁用登录时执行提示脚本
run-command chmod -x /etc/update-motd.d/10-help-text /etc/update-motd.d/90-updates-available /etc/update-motd.d/91-release-upgrade
